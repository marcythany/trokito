(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[239],{1056:(e,t,r)=>{"use strict";r.d(t,{j:()=>s});class a{isWebAuthnSupported(){return void 0!==window.PublicKeyCredential&&void 0!==navigator.credentials}async registerWithWebAuthn(e){if(!this.isWebAuthnSupported())throw Error("WebAuthn n\xe3o \xe9 suportado neste navegador");try{let t={challenge:this.generateChallenge(),rp:{name:"Trokito",id:window.location.hostname},user:{id:this.stringToBuffer(e),name:e,displayName:e},pubKeyCredParams:[{type:"public-key",alg:-7}],authenticatorSelection:{authenticatorAttachment:"platform",requireResidentKey:!1,userVerification:"preferred"},timeout:6e4,attestation:"none"};if(!await navigator.credentials.create({publicKey:t}))throw Error("Falha ao criar credencial");let r={id:e,name:e,createdAt:new Date};return localStorage.setItem(this.USER_STORAGE_KEY,JSON.stringify(r)),r}catch(e){return console.error("Erro no registro com WebAuthn:",e),null}}async authenticateWithWebAuthn(){if(!this.isWebAuthnSupported())throw Error("WebAuthn n\xe3o \xe9 suportado neste navegador");try{let e=localStorage.getItem(this.USER_STORAGE_KEY);if(!e)throw Error("Nenhum usu\xe1rio registrado");let t=JSON.parse(e),r=this.generateChallenge();if(!await navigator.credentials.get({publicKey:{challenge:r,timeout:6e4,userVerification:"preferred"}}))throw Error("Falha na autentica\xe7\xe3o");return t}catch(e){return console.error("Erro na autentica\xe7\xe3o com WebAuthn:",e),null}}setPIN(e){localStorage.setItem(this.PIN_STORAGE_KEY,e)}verifyPIN(e){return localStorage.getItem(this.PIN_STORAGE_KEY)===e}isAuthenticated(){return null!==localStorage.getItem(this.USER_STORAGE_KEY)}getCurrentUser(){let e=localStorage.getItem(this.USER_STORAGE_KEY);return e?JSON.parse(e):null}logout(){localStorage.removeItem(this.USER_STORAGE_KEY),localStorage.removeItem(this.PIN_STORAGE_KEY)}generateChallenge(){let e=new Uint8Array(32);return window.crypto.getRandomValues(e),e.buffer}stringToBuffer(e){return new TextEncoder().encode(e).buffer}constructor(){this.USER_STORAGE_KEY="trokito_user",this.PIN_STORAGE_KEY="trokito_pin"}}let s=new a},3999:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(2596),s=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},5328:(e,t,r)=>{"use strict";r.d(t,{db:()=>s});class a{async initDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.DB_NAME,this.DB_VERSION);r.onerror=()=>{console.error("Erro ao abrir o banco de dados:",r.error),t(r.error)},r.onsuccess=()=>{this.db=r.result,e()},r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(this.CLOSINGS_STORE)||t.createObjectStore(this.CLOSINGS_STORE,{keyPath:"id",autoIncrement:!0}).createIndex("date","date",{unique:!1}),t.objectStoreNames.contains(this.CALCULATIONS_STORE)||t.createObjectStore(this.CALCULATIONS_STORE,{keyPath:"id",autoIncrement:!0}).createIndex("date","date",{unique:!1})}})}async getDB(){return this.db||await this.initDB(),this.db}async addClosing(e){let t=(await this.getDB()).transaction([this.CLOSINGS_STORE],"readwrite").objectStore(this.CLOSINGS_STORE);return new Promise((r,a)=>{let s=t.add({...e,date:e.date||new Date});s.onsuccess=()=>{r(s.result)},s.onerror=()=>{console.error("Erro ao adicionar fechamento:",s.error),a(s.error)}})}async getAllClosings(){let e=(await this.getDB()).transaction([this.CLOSINGS_STORE],"readonly").objectStore(this.CLOSINGS_STORE);return new Promise((t,r)=>{let a=e.getAll();a.onsuccess=()=>{t(a.result)},a.onerror=()=>{console.error("Erro ao buscar fechamentos:",a.error),r(a.error)}})}async getClosingById(e){let t=(await this.getDB()).transaction([this.CLOSINGS_STORE],"readonly").objectStore(this.CLOSINGS_STORE);return new Promise((r,a)=>{let s=t.get(e);s.onsuccess=()=>{r(s.result)},s.onerror=()=>{console.error("Erro ao buscar fechamento:",s.error),a(s.error)}})}async deleteClosing(e){let t=(await this.getDB()).transaction([this.CLOSINGS_STORE],"readwrite").objectStore(this.CLOSINGS_STORE);return new Promise((r,a)=>{let s=t.delete(e);s.onsuccess=()=>{r()},s.onerror=()=>{console.error("Erro ao deletar fechamento:",s.error),a(s.error)}})}async exportToCSV(){let e=await this.getAllClosings(),t="Data,Operador,Total,Observa\xe7\xf5es\n";return e.forEach(e=>{let r=e.date.toLocaleDateString("pt-BR"),a=(e.total/100).toFixed(2).replace(".",","),s=e.operatorName||"",n=e.notes||"",i=e=>e.includes(",")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e;t+="".concat(i(r),",").concat(i(s),",").concat(i(a),",").concat(i(n),"\n")}),t}async addCalculation(e){let t=(await this.getDB()).transaction([this.CALCULATIONS_STORE],"readwrite").objectStore(this.CALCULATIONS_STORE);return new Promise((r,a)=>{let s=t.add({...e,date:e.date||new Date});s.onsuccess=()=>{r(s.result)},s.onerror=()=>{console.error("Erro ao adicionar c\xe1lculo:",s.error),a(s.error)}})}async getAllCalculations(){let e=(await this.getDB()).transaction([this.CALCULATIONS_STORE],"readonly").objectStore(this.CALCULATIONS_STORE);return new Promise((t,r)=>{let a=e.getAll();a.onsuccess=()=>{t(a.result)},a.onerror=()=>{console.error("Erro ao buscar c\xe1lculos:",a.error),r(a.error)}})}async deleteCalculation(e){let t=(await this.getDB()).transaction([this.CALCULATIONS_STORE],"readwrite").objectStore(this.CALCULATIONS_STORE);return new Promise((r,a)=>{let s=t.delete(e);s.onsuccess=()=>{r()},s.onerror=()=>{console.error("Erro ao deletar c\xe1lculo:",s.error),a(s.error)}})}constructor(){this.db=null,this.DB_NAME="TrokitoDB",this.DB_VERSION=2,this.CLOSINGS_STORE="closings",this.CALCULATIONS_STORE="calculations",this.initDB()}}let s=new a},6219:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var a=r(5155),s=r(6639),n=r(8145),i=r(7168),o=r(8482),c=r(2115),l=r(2473),d=r(3999);function u(e){let{className:t,...r}=e;return(0,a.jsx)(l.bL,{"data-slot":"tabs",className:(0,d.cn)("flex flex-col gap-2",t),...r})}function m(e){let{className:t,...r}=e;return(0,a.jsx)(l.B8,{"data-slot":"tabs-list",className:(0,d.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...r})}function h(e){let{className:t,...r}=e;return(0,a.jsx)(l.l9,{"data-slot":"tabs-trigger",className:(0,d.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r})}function g(e){let{className:t,...r}=e;return(0,a.jsx)(l.UC,{"data-slot":"tabs-content",className:(0,d.cn)("flex-1 outline-none",t),...r})}var x=r(5328),f=r(7550),p=r(6740),v=r(7434),b=r(2525),N=r(6874),j=r.n(N);function S(){let[e,t]=(0,c.useState)([]),[r,l]=(0,c.useState)([]),[d,N]=(0,c.useState)(!0),S=(0,c.useRef)(null);(0,c.useEffect)(()=>{S.current&&S.current.focus(),y()},[]);let y=async()=>{try{let[e,r]=await Promise.all([x.db.getAllClosings(),x.db.getAllCalculations()]);t(e.sort((e,t)=>t.date.getTime()-e.date.getTime())),l(r.sort((e,t)=>t.date.getTime()-e.date.getTime()))}catch(e){console.error("Erro ao carregar hist\xf3rico:",e)}finally{N(!1)}},w=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e/100),E=e=>new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e),O=async r=>{if(confirm("Tem certeza que deseja excluir este fechamento?"))try{await x.db.deleteClosing(r),t(e.filter(e=>e.id!==r))}catch(e){console.error("Erro ao excluir fechamento:",e),alert("Erro ao excluir fechamento.")}},A=async e=>{if(confirm("Tem certeza que deseja excluir este c\xe1lculo?"))try{await x.db.deleteCalculation(e),l(r.filter(t=>t.id!==e))}catch(e){console.error("Erro ao excluir c\xe1lculo:",e),alert("Erro ao excluir c\xe1lculo.")}};return d?(0,a.jsx)(s.A,{children:(0,a.jsx)("div",{className:"min-h-screen bg-background p-4",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto space-y-6",children:(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Carregando hist\xf3rico..."})})})})}):(0,a.jsx)(s.A,{children:(0,a.jsx)("div",{className:"min-h-screen bg-background p-4",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto space-y-6",children:(0,a.jsxs)("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[(0,a.jsx)(j(),{href:"/",children:(0,a.jsxs)(i.$,{variant:"ghost",className:"mb-4 pl-0 focus:ring-2 focus:ring-primary focus:ring-offset-2","aria-label":"Voltar para a p\xe1gina inicial",children:[(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Voltar"]})}),(0,a.jsxs)(o.Zp,{children:[(0,a.jsxs)(o.aR,{children:[(0,a.jsxs)(o.ZB,{ref:S,tabIndex:-1,className:"flex items-center gap-2 focus:outline-none",children:[(0,a.jsx)(p.A,{className:"h-6 w-6 text-primary","aria-hidden":"true"}),"Hist\xf3rico de Opera\xe7\xf5es"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Visualize seus c\xe1lculos e fechamentos anteriores"})]}),(0,a.jsx)(o.Wu,{children:(0,a.jsxs)(u,{defaultValue:"calculations",className:"w-full",children:[(0,a.jsxs)(m,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(h,{value:"calculations",className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-4 w-4"}),"C\xe1lculos (",r.length,")"]}),(0,a.jsxs)(h,{value:"closings",className:"flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"h-4 w-4"}),"Fechamentos (",e.length,")"]})]}),(0,a.jsx)(g,{value:"calculations",className:"space-y-4 mt-6",children:0===r.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(p.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Nenhum c\xe1lculo encontrado"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Seus c\xe1lculos aparecer\xe3o aqui ap\xf3s o primeiro uso"})]}):(0,a.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:r.map((e,t)=>(0,a.jsx)(o.Zp,{className:"animate-in fade-in slide-in-from-left-2 duration-300",style:{animationDelay:"".concat(50*t,"ms")},children:(0,a.jsxs)(o.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:E(e.date)}),(0,a.jsxs)("div",{className:"flex gap-4 text-sm ".concat(e.payment>0?"":"flex-col"),children:[(0,a.jsxs)("span",{children:["Total: ",w(e.total)]}),e.payment>0&&(0,a.jsxs)("span",{children:["Pago: ",w(e.payment)]})]}),e.customerContribution>0&&(0,a.jsx)("div",{className:"flex gap-4 text-sm",children:(0,a.jsxs)("span",{className:"text-green-600",children:["Cliente ajudou:"," ",w(e.customerContribution)]})})]}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>e.id&&A(e.id),className:"text-destructive hover:text-destructive","aria-label":"Excluir c\xe1lculo",children:(0,a.jsx)(b.A,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{className:"font-medium",children:["Troco: ",w(e.change)]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.breakdown.slice(0,3).map((e,t)=>(0,a.jsxs)(n.E,{variant:"secondary",className:"text-xs",children:[e.denomination.label,":"," ",e.count]},t)),e.breakdown.length>3&&(0,a.jsxs)(n.E,{variant:"outline",className:"text-xs",children:["+",e.breakdown.length-3," mais"]})]})]})})]})},e.id))})}),(0,a.jsx)(g,{value:"closings",className:"space-y-4 mt-6",children:0===e.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(v.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Nenhum fechamento encontrado"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Seus fechamentos aparecer\xe3o aqui ap\xf3s o primeiro uso"})]}):(0,a.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:e.map((e,t)=>(0,a.jsx)(o.Zp,{className:"animate-in fade-in slide-in-from-left-2 duration-300",style:{animationDelay:"".concat(50*t,"ms")},children:(0,a.jsxs)(o.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:E(e.date)}),(0,a.jsxs)("p",{className:"font-medium",children:["Operador:"," ",e.operatorName||"N\xe3o informado"]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Total: ",w(e.total)]})]}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>e.id&&O(e.id),className:"text-destructive hover:text-destructive","aria-label":"Excluir fechamento",children:(0,a.jsx)(b.A,{className:"h-4 w-4"})})]}),e.notes&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Observa\xe7\xf5es: ",e.notes]})]})},e.id))})})]})})]})]})})})})}},6639:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var a=r(5155),s=r(1056),n=r(5695),i=r(2115);function o(e){let{children:t}=e,r=(0,n.useRouter)(),o=(0,i.useRef)(null),[c,l]=(0,i.useState)(!1),[d,u]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{l(!0);let e=s.j.isAuthenticated();u(e),e||r.push("/login")},[r]),(0,i.useEffect)(()=>{d&&o.current&&o.current.focus()},[d]),c)?d?(0,a.jsx)("div",{ref:o,tabIndex:-1,className:"focus:outline-none",children:t}):(0,a.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",role:"status","aria-live":"polite",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Redirecionando para login..."})}):(0,a.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",role:"status","aria-live":"polite",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Verificando autentica\xe7\xe3o..."})})}},7168:(e,t,r)=>{"use strict";r.d(t,{$:()=>c});var a=r(5155);r(2115);var s=r(9708),n=r(2085),i=r(3999);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(e){let{className:t,variant:r,size:n,asChild:c=!1,...l}=e,d=c?s.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,i.cn)(o({variant:r,size:n,className:t})),...l})}},8145:(e,t,r)=>{"use strict";r.d(t,{E:()=>c});var a=r(5155);r(2115);var s=r(9708),n=r(2085),i=r(3999);let o=(0,n.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:r,asChild:n=!1,...c}=e,l=n?s.DX:"span";return(0,a.jsx)(l,{"data-slot":"badge",className:(0,i.cn)(o({variant:r}),t),...c})}},8464:(e,t,r)=>{Promise.resolve().then(r.bind(r,6219))},8482:(e,t,r)=>{"use strict";r.d(t,{Wu:()=>c,ZB:()=>o,Zp:()=>n,aR:()=>i});var a=r(5155);r(2115);var s=r(3999);function n(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function i(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function o(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...r})}function c(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...r})}}},e=>{var t=t=>e(e.s=t);e.O(0,[352,220,650,777,441,684,358],()=>t(8464)),_N_E=e.O()}]);