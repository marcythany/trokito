"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[560],{1056:(e,r,t)=>{t.d(r,{j:()=>o});class a{isWebAuthnSupported(){return void 0!==window.PublicKeyCredential&&void 0!==navigator.credentials}async registerWithWebAuthn(e){if(!this.isWebAuthnSupported())throw Error("WebAuthn n\xe3o \xe9 suportado neste navegador");try{let r={challenge:this.generateChallenge(),rp:{name:"Trokito",id:window.location.hostname},user:{id:this.stringToBuffer(e),name:e,displayName:e},pubKeyCredParams:[{type:"public-key",alg:-7}],authenticatorSelection:{authenticatorAttachment:"platform",requireResidentKey:!1,userVerification:"preferred"},timeout:6e4,attestation:"none"};if(!await navigator.credentials.create({publicKey:r}))throw Error("Falha ao criar credencial");let t={id:e,name:e,createdAt:new Date};return localStorage.setItem(this.USER_STORAGE_KEY,JSON.stringify(t)),t}catch(e){return console.error("Erro no registro com WebAuthn:",e),null}}async authenticateWithWebAuthn(){if(!this.isWebAuthnSupported())throw Error("WebAuthn n\xe3o \xe9 suportado neste navegador");try{let e=localStorage.getItem(this.USER_STORAGE_KEY);if(!e)throw Error("Nenhum usu\xe1rio registrado");let r=JSON.parse(e),t=this.generateChallenge();if(!await navigator.credentials.get({publicKey:{challenge:t,timeout:6e4,userVerification:"preferred"}}))throw Error("Falha na autentica\xe7\xe3o");return r}catch(e){return console.error("Erro na autentica\xe7\xe3o com WebAuthn:",e),null}}setPIN(e){localStorage.setItem(this.PIN_STORAGE_KEY,e)}verifyPIN(e){return localStorage.getItem(this.PIN_STORAGE_KEY)===e}isAuthenticated(){return null!==localStorage.getItem(this.USER_STORAGE_KEY)}getCurrentUser(){let e=localStorage.getItem(this.USER_STORAGE_KEY);return e?JSON.parse(e):null}logout(){localStorage.removeItem(this.USER_STORAGE_KEY),localStorage.removeItem(this.PIN_STORAGE_KEY)}generateChallenge(){let e=new Uint8Array(32);return window.crypto.getRandomValues(e),e.buffer}stringToBuffer(e){return new TextEncoder().encode(e).buffer}constructor(){this.USER_STORAGE_KEY="trokito_user",this.PIN_STORAGE_KEY="trokito_pin"}}let o=new a},3999:(e,r,t)=>{t.d(r,{cn:()=>n});var a=t(2596),o=t(9688);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,o.QP)((0,a.$)(r))}},5328:(e,r,t)=>{t.d(r,{db:()=>o});class a{async initDB(){return new Promise((e,r)=>{let t=indexedDB.open(this.DB_NAME,this.DB_VERSION);t.onerror=()=>{console.error("Erro ao abrir o banco de dados:",t.error),r(t.error)},t.onsuccess=()=>{this.db=t.result,e()},t.onupgradeneeded=e=>{let r=e.target.result;r.objectStoreNames.contains(this.CLOSINGS_STORE)||r.createObjectStore(this.CLOSINGS_STORE,{keyPath:"id",autoIncrement:!0}).createIndex("date","date",{unique:!1}),r.objectStoreNames.contains(this.CALCULATIONS_STORE)||r.createObjectStore(this.CALCULATIONS_STORE,{keyPath:"id",autoIncrement:!0}).createIndex("date","date",{unique:!1})}})}async getDB(){return this.db||await this.initDB(),this.db}async addClosing(e){let r=(await this.getDB()).transaction([this.CLOSINGS_STORE],"readwrite").objectStore(this.CLOSINGS_STORE);return new Promise((t,a)=>{let o=r.add({...e,date:e.date||new Date});o.onsuccess=()=>{t(o.result)},o.onerror=()=>{console.error("Erro ao adicionar fechamento:",o.error),a(o.error)}})}async getAllClosings(){let e=(await this.getDB()).transaction([this.CLOSINGS_STORE],"readonly").objectStore(this.CLOSINGS_STORE);return new Promise((r,t)=>{let a=e.getAll();a.onsuccess=()=>{r(a.result)},a.onerror=()=>{console.error("Erro ao buscar fechamentos:",a.error),t(a.error)}})}async getClosingById(e){let r=(await this.getDB()).transaction([this.CLOSINGS_STORE],"readonly").objectStore(this.CLOSINGS_STORE);return new Promise((t,a)=>{let o=r.get(e);o.onsuccess=()=>{t(o.result)},o.onerror=()=>{console.error("Erro ao buscar fechamento:",o.error),a(o.error)}})}async deleteClosing(e){let r=(await this.getDB()).transaction([this.CLOSINGS_STORE],"readwrite").objectStore(this.CLOSINGS_STORE);return new Promise((t,a)=>{let o=r.delete(e);o.onsuccess=()=>{t()},o.onerror=()=>{console.error("Erro ao deletar fechamento:",o.error),a(o.error)}})}async exportToCSV(){let e=await this.getAllClosings(),r="Data,Operador,Total,Observa\xe7\xf5es\n";return e.forEach(e=>{let t=e.date.toLocaleDateString("pt-BR"),a=(e.total/100).toFixed(2).replace(".",","),o=e.operatorName||"",n=e.notes||"",i=e=>e.includes(",")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e;r+="".concat(i(t),",").concat(i(o),",").concat(i(a),",").concat(i(n),"\n")}),r}async addCalculation(e){let r=(await this.getDB()).transaction([this.CALCULATIONS_STORE],"readwrite").objectStore(this.CALCULATIONS_STORE);return new Promise((t,a)=>{let o=r.add({...e,date:e.date||new Date});o.onsuccess=()=>{t(o.result)},o.onerror=()=>{console.error("Erro ao adicionar c\xe1lculo:",o.error),a(o.error)}})}async getAllCalculations(){let e=(await this.getDB()).transaction([this.CALCULATIONS_STORE],"readonly").objectStore(this.CALCULATIONS_STORE);return new Promise((r,t)=>{let a=e.getAll();a.onsuccess=()=>{r(a.result)},a.onerror=()=>{console.error("Erro ao buscar c\xe1lculos:",a.error),t(a.error)}})}async deleteCalculation(e){let r=(await this.getDB()).transaction([this.CALCULATIONS_STORE],"readwrite").objectStore(this.CALCULATIONS_STORE);return new Promise((t,a)=>{let o=r.delete(e);o.onsuccess=()=>{t()},o.onerror=()=>{console.error("Erro ao deletar c\xe1lculo:",o.error),a(o.error)}})}constructor(){this.db=null,this.DB_NAME="TrokitoDB",this.DB_VERSION=2,this.CLOSINGS_STORE="closings",this.CALCULATIONS_STORE="calculations",this.initDB()}}let o=new a},6639:(e,r,t)=>{t.d(r,{A:()=>s});var a=t(5155),o=t(1056),n=t(5695),i=t(2115);function s(e){let{children:r}=e,t=(0,n.useRouter)(),s=(0,i.useRef)(null),[c,l]=(0,i.useState)(!1),[d,u]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{l(!0);let e=o.j.isAuthenticated();u(e),e||t.push("/login")},[t]),(0,i.useEffect)(()=>{d&&s.current&&s.current.focus()},[d]),c)?d?(0,a.jsx)("div",{ref:s,tabIndex:-1,className:"focus:outline-none",children:r}):(0,a.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",role:"status","aria-live":"polite",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Redirecionando para login..."})}):(0,a.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",role:"status","aria-live":"polite",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Verificando autentica\xe7\xe3o..."})})}},7168:(e,r,t)=>{t.d(r,{$:()=>c});var a=t(5155);t(2115);var o=t(9708),n=t(2085),i=t(3999);let s=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(e){let{className:r,variant:t,size:n,asChild:c=!1,...l}=e,d=c?o.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,i.cn)(s({variant:t,size:n,className:r})),...l})}},8145:(e,r,t)=>{t.d(r,{E:()=>c});var a=t(5155);t(2115);var o=t(9708),n=t(2085),i=t(3999);let s=(0,n.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:r,variant:t,asChild:n=!1,...c}=e,l=n?o.DX:"span";return(0,a.jsx)(l,{"data-slot":"badge",className:(0,i.cn)(s({variant:t}),r),...c})}},8482:(e,r,t)=>{t.d(r,{Wu:()=>c,ZB:()=>s,Zp:()=>n,aR:()=>i});var a=t(5155);t(2115);var o=t(3999);function n(e){let{className:r,...t}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,o.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",r),...t})}function i(e){let{className:r,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,o.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",r),...t})}function s(e){let{className:r,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,o.cn)("leading-none font-semibold",r),...t})}function c(e){let{className:r,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,o.cn)("px-6",r),...t})}}}]);